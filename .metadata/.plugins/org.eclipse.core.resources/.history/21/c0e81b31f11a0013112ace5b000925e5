package cont;

import java.io.IOException;
import java.math.BigInteger;
import java.nio.ByteBuffer;
import java.nio.channels.SocketChannel;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

import NioServer.Message;

public class ConnectionManager {

	ByteBuffer std;
	SocketChannel socket;
	private static int getPort(){
		return 12345;
	}
	
	ConnectionManager(){
		std = ByteBuffer.allocate(8192);
	}
	
	private void sendBuffer(){
		
		while(std.hasRemaining()){
			try {
				socket.write(std);
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		std.flip();
		std.clear();
	}
	private void putStringIntoBuffer(String s){
		std.clear();
		std.put(s.getBytes());
		std.flip();
	}
	
	public void sendMessage(String message){
		putStringIntoBuffer(message);
		sendBuffer();
	}
	public String readMessage(){
		String message = "";
		std.clear();
		int ret = 0;
		try {
			ret = socket.read(std);
		} catch (IOException e) {
			System.out.println("B³¹d przy odczytaniu wiadomoœci");
		}
		if(ret == -1){
			System.out.println("NO MESSAGE");
		}
		std.flip();
		byte[] bytes = new byte[100];
		
		for(int i = 0; i<100; i++)
			bytes[i] = std.get();
		
		return message;
	}
	public static class MessageManager{
		
		public static String buildMessage(String ... args){
			String message = "";
			for(String s : args){
				message += s + ";";
			}
			return message;
		}
		public static String hashString(String mes){
			MessageDigest md5;
			try {
				md5 = MessageDigest.getInstance("MD5");
			} catch (NoSuchAlgorithmException e) {
				e.printStackTrace();
				return null; //nie powinna zdarzyæ sie ta sytuacja.bardzo.
			}
			md5.update(mes.getBytes());
			return (new BigInteger(1,md5.digest())).toString(16);
		}
		public static String[] decodeResponse(String response){
			return response.split("\\|");
		}
		public static int whichHostNotUse(String login){
			int result = 0;
			
			return result;
		}
	}
}
